---
title: Tiered Cake
categories: [puzzle,modeling]
tags: [combinatorial-optimization,integer-programming,combinatorics]
bibliography: references.bib
image: images/gemini/cake.png
#source: 
#  - 52 semaines de défis mathématiques
---

## Problem description

This puzzle, published by Mickaël Launay and Dominique Souder [@souder2002_52semaines], reads as follows.

A tiered cake has a total of $2004$ candles. 
The top tier contains some number of candles, and each tier below it has $k$ more candles than the tier directly above. 
If the cake is built to have the maximum possible number of tiers, how many candles are on the top tier?

## MIP model

In this model, no logical reasoning is derived from the problem statement, except for the fact that there cannot be more than
$63$ layers, because $1+2+\dots+63=2016>2004$. Otherwise, an obvious upper bound is $2004$.

#### Parameters

- $L=\{1,\dots,63\}$: set of potential layers (the top layer is layer $1$)

#### Variables

- $\textcolor{blue}{x}_{i} \in \mathbb{N}$: number of candles on layer $i\in L$
- $\textcolor{blue}{y}_{i} \in \{0,1\}$: takes value $1$ if and only if layer $i \in L$ exists
- $\textcolor{blue}{k} \in \mathbb{N}$: difference of candles between two consecutive layers

#### Objective function

The cake has a maximum number of layers:

$$
\max \sum_{i \in L} \textcolor{blue}{y}_{i}
$$

subject to:

#### Constraints

- The total number of candles is $2004$:

$$
\sum_{i \in L} \textcolor{blue}{x}_{i}= 2004 \\
$$

- Between two layers, the difference is $\textcolor{blue}{k}$:

\begin{align}
- M(1-\textcolor{blue}{y}_{i})+\textcolor{blue}{k}  \le  \textcolor{blue}{x}_{i}-\textcolor{blue}{x}_{i-1} \le \textcolor{blue}{k} + M(1-\textcolor{blue}{y}_{i}) \quad \forall i\in L,\; i>1
\end{align}

$M$ can be set to $2004$.

- The difference is at least equal to $1$

$$
\textcolor{blue}{k} \ge 1:
$$

- A layer that does not exist cannot have any candles:

$$
\textcolor{blue}{x}_{i} \le M \;\textcolor{blue}{y}_{i}
$$

$M$ can be set to $2004$.


- If a layer does not exist, then layers beneath do not exist either:

$$
\textcolor{blue}{y}_{i} \le \textcolor{blue}{y}_{i-1} \quad \forall i \in L, \; i>1
$$


## Solution

Solving this problem takes less than $4$ seconds with the default solver
in [PuLP](https://coin-or.github.io/pulp/) (CBC) and yields:

{{< embed notebooks/tiered_cake.ipynb#75251953-f8df-4818-bdbd-9c2e93b00a20 >}}

Note that the solution is not unique, the set of optimal solutions is $(k,n)\in\{(1,72),(3,49),(5,26),(7,3)\}$.

With a bit of reasoning, one can determine that the number of layers is necessarily $24$. 
In this case, the variables $\textcolor{blue}{y}_i$​ can be omitted, 
along with the last two sets of constraints.